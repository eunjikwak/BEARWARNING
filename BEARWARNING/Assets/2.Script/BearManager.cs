using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.AI;
using UnityEngine.UI;

public class BearManager : MonoBehaviour
{

    //AI변수
    NavMeshAgent agent;
    //타겟 위치
    Transform player;

    //플레이 유무
    public bool isON;
    //곰 움직임 유무
    bool isMove;
    //숫자 이미지
    public Image number_Img;
    //숫자 변경 이미지 배열
    public Sprite[] number_sprite;
    //시간 변수
    float time;
    //도망치라는 텍스트 
    public GameObject runText;


    public enum EnmeyState
    {
        Idle,
        Walk,
        Run,
        Attak,
        Damaged
    }

    public EnmeyState eState;



    // Start is called before the first frame update
    void Start()
    {
        //애너미 AI
        agent = GetComponent<NavMeshAgent>();
        //플레이어 위치 가져오기
        player = FindObjectOfType<CarController>().transform;
    }

    // Update is called once per frame
    void Update()
    {
        //게임이 시작됐다면
        if (isON)
        {
            //움직이기전 UI활성화
            BeforeMove();
            //도망치라는 멘트 활성화
            runText.SetActive(true);


        }
        //움직이고 있다면 
        if (isMove)
        {
            //도망치라는 멘트 비활성화
            runText.SetActive(false);
            //곰 움직임 시작
            BearMove();
        }


        switch (eState)
        {
            case EnmeyState.Idle: Idle(); break;
            case EnmeyState.Walk: Walk(); break;
            case EnmeyState.Run: Run(); break;
            case EnmeyState.Attak: Attack(); break;
            case EnmeyState.Damaged: Damged(); break;

        }


    }

    void Idle()
    {
        //기본애니메이션 

        //플레이어가 3초가 지나면 Walk함수 전환

        //플레이어와 멀어졌다면 

        //Walk상태전환
    }

    void Walk()
    {
        //걷는 애니메이션

        //플레이어와 가까워지면 

        //어택 전환 

        //플레이어와 멀어지면 

        //런 전환


    }

    void Run()
    {
        //걷는 애니메이션*2

        //플레이어와 가까워지면 

        //walk 화면 전환 




    }

    void Attack()
    {
        //공격 애니메이션

        //공격해서 자동차가 맞았다면 

        //Hp감소 

        //플레이어와 멀어졌다면 

        //Walk 화면 전환
    }

    void Damged()
    {


        //꿀 아이템에 닿았다면 
        //맞는 애니메이션
        //아이들 상태 전환 

    }

    //곰이움직이는 함수
    void BearMove()
    {

        //곰의 움직이는 거리를 플레이어의 위치로
      
        agent.destination = player.position;
        //print("곰이 따라오는거 시작");

       
    }

    //움직이기 전 숫자 표시 함수
    void BeforeMove()
    {

        //시간 (초 세기위해서)
        time += Time.deltaTime;

        //플롯 시간을 인트로 변환해줌 
        int sec = (int)time;
        //1초가 지났다면
        if (sec == 1)
        {
            //2라는 스프라이트를 이미지에 저장
            number_Img.sprite = number_sprite[0];
        }
        //2초가 지났다면
        else if (sec == 2)
        {
            //1이라는 스프라이트를 이미지에 저장
            number_Img.sprite = number_sprite[1];
        }
        //3초가 지났다면 
        else if (sec == 3)
        {
            //이미지 UI비활성화
            number_Img.gameObject.SetActive(false);
            //움직이기 시작
            isMove = true;

        }


    }

    private void OnTriggerEnter(Collider other)
    {
        if(other.gameObject.tag=="HoneyAttck")
        {
           
            print("아악! 곰 넘어짐 ");
            agent.isStopped = true;

            //Destroy(other.gameObject, 5);

           
        }
    }

}
